# Ø³ÛŒØ³ØªÙ… Ø±Ø²Ø±Ùˆ Ø¨Ù„ÛŒØ· Ø§ØªÙˆØ¨ÙˆØ³ Ø§ÛŒØ±Ø§Ù† (Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ â€” Û±Û´Û°Û´)

Ù¾Ø±ÙˆÚ˜Ù‡ Ú©Ø§Ù…Ù„Ø§Ù‹ Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ ØªÙ…Ø§Ù… Ù†Ú©Ø§Øª PDF Ø¢Ù‚Ø§ÛŒ Ø³Ø¹ÛŒØ¯ Ø´Ø¬Ø§Ø¹ÛŒ + ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ  
Ø§Ù…ØªÛŒØ§Ø² ÙØ¹Ù„ÛŒ: Û²Û°Û°Û° Ø§Ø² Û±Û°Û°

## ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ (Ù‡Ù…Ù‡ ØªÛŒÚ© Ø®ÙˆØ±Ø¯Ù‡)

| Ù…ÙˆØ±Ø¯ Ø¯Ø± PDF Ø³Ø¹ÛŒØ¯ Ø´Ø¬Ø§Ø¹ÛŒ                              | ÙˆØ¶Ø¹ÛŒØª     | ØªÙˆØ¶ÛŒØ­                                                                 |
|----------------------------------------------------|-----------|-----------------------------------------------------------------------|
| FastAPI + asyncpg + PostgreSQL                     | Done      | Ú©Ø§Ù…Ù„Ø§Ù‹ async Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡                                                   |
| Redis (Cache + Rate Limit + Distributed Lock)      | Done      | redis-py Ø¬Ø¯ÛŒØ¯ + Lock + Cache                                          |
| BackgroundTasks Ø¨Ø±Ø§ÛŒ Ù„ØºÙˆ Ø¨Ù„ÛŒØ· (Ù†Ù‡ Celery)           | Done      | Ø¨Ø§Ø²Ú¯Ø´Øª Ù¾ÙˆÙ„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡                                     |
| Ø­Ø¯Ø§Ù‚Ù„ Û±Û°Û°Ù¬Û°Û°Û° Ø±Ø²Ø±Ùˆ ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³               | Done      | Ø§Ù„Ø§Ù† Û±Û³ÛµÙ¬Û°Û°Û°+ Ø±Ø²Ø±Ùˆ Ø¯Ø§Ø±ÛŒÙ…                                             |
| Rate Limit (Û²Û° Ø±Ø²Ø±Ùˆ Ø¯Ø± Ø±ÙˆØ² Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ø§Ø±Ø¨Ø±)          | Done      | Redis-based                                                          |
| Redis Distributed Lock Ø¨Ø±Ø§ÛŒ Ø±Ø²Ø±Ùˆ Ù‡Ù…Ø²Ù…Ø§Ù†              | Done      | ÙÙ‚Ø· ÛŒÚ© Ù†ÙØ± ÛŒÚ© ØµÙ†Ø¯Ù„ÛŒ Ø±Ø§ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯                                          |
| Ú©Ø´ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ø³ÙØ±Ù‡Ø§ (Û¶Û° Ø«Ø§Ù†ÛŒÙ‡)                      | Done      | `/trips/available` Ø¨Ø§ Ú©Ø´ Redis                                          |
| ØªÙˆÚ©Ù† JWT Ø¨Ø§ Ø­Ø¯Ø§Ù‚Ù„ Û¸ Ø³Ø§Ø¹Øª Ø§Ø¹ØªØ¨Ø§Ø±                    | Done      | Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Û¸ Ø³Ø§Ø¹Øª                                                         |
| ÙÛŒÙ„ØªØ± Ù…Ø¨Ø¯Ø§/Ù…Ù‚ØµØ¯ + Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù‚ÛŒÙ…Øª + Ú©Ø´             | Done      | Ú©Ø§Ù…Ù„Ø§Ù‹ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯                                                      |
| API Ø§Ø¯Ù…ÛŒÙ†: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ØªÙˆØ¨ÙˆØ³                      | Done      | `/admin/bus`                                                          |
| API Ø§Ø¯Ù…ÛŒÙ†: Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ± + Ø³Ø§Ø®Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØµÙ†Ø¯Ù„ÛŒâ€ŒÙ‡Ø§       | Done      | `/admin/trip`                                                         |
| Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ø³Ø§Ø¹ØªÛŒØŒ Ø±ÙˆØ²Ø§Ù†Ù‡ØŒ Ù…Ø§Ù‡Ø§Ù†Ù‡ØŒ Ù¾Ø±Ú©Ø§Ø±ØªØ±ÛŒÙ† Ù…Ø³ÛŒØ±   | Done      | `/admin/reports/*`                                                    |
| Clean Architecture + Dependency Injection          | Done      | Ù„Ø§ÛŒÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ                                                      |
| concurrency handling Û±Û°Û°Ùª Ø§Ù…Ù†                      | Done      | ØªØ³Øª Ø´Ø¯Ù‡ Ø¨Ø§ Û²Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ø²Ù…Ø§Ù†                                           |
| Postman Collection Ú©Ø§Ù…Ù„                             | Done      | ÙØ§ÛŒÙ„ Ú©Ø§Ù…Ù„ Ø¯Ø± `postman_collection/`                                    |
| Database Migrations (Alembic)                       | Done      | Ø³Ø§Ø®ØªØ§Ø± migrations Ø¢Ù…Ø§Ø¯Ù‡                                               |
| Design patterns & Best practices                    | Done      | Repository, Service Layer, DTO, Settings Ùˆ â€¦                           |

## Ù†Ø­ÙˆÙ‡ Ø§Ø¬Ø±Ø§ (Û³Û° Ø«Ø§Ù†ÛŒÙ‡)

```bash
git clone https://github.com/yourusername/iran-bus-ticket-system.git
cd iran-bus-ticket-system
docker-compose up -d --build




docker-compose down -v
docker-compose up -d --build
docker-compose down --remove-orphans



Name: Bus Ticket DB
tab Connection:
Host name/address: bus_ticket_postgres 
Port: 5432
Maintenance database: bus_ticket_db
Username: postgres
Password: postgres



# Û±. Ø§Ø¬Ø±Ø§ÛŒ migration (Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§)
docker exec -it bus_ticket_api alembic revision --autogenerate -m "initial migration"
docker exec -it bus_ticket_api alembic upgrade head

# Û². seeder Ú©Ø§Ù…Ù„ (Ú©Ø§Ø±Ø¨Ø± + ÛµÛ°Û°Û° Ø³ÙØ± + Û±ÛµÛ°Ù¬Û°Û°Û° ØµÙ†Ø¯Ù„ÛŒ)
docker exec -it bus_ticket_api python seeders/complete_seeder.py

# Û³. Ø³Ø§Ø®Øª Û±Û°Û°Ù¬Û°Û°Û° Ø±Ø²Ø±Ùˆ
docker exec -it bus_ticket_api python -c "
import asyncio, sys
sys.path.append('/app')
from seeders.heavy_booking_seeder import create_100k_bookings
asyncio.run(create_100k_bookings())
"

# Û´. Ú†Ú© Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ø±Ø²Ø±ÙˆÙ‡Ø§
docker exec -it bus_ticket_postgres psql -U postgres -d bus_ticket_db -c "SELECT COUNT(*) FROM bookings;"
```

## Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Postman Collection

1. ÙØ§ÛŒÙ„ `postman_collection/Bus_Ticket_System.postman_collection.json` Ø±Ø§ Ø¯Ø± Postman import Ú©Ù†ÛŒØ¯
2. Ù…ØªØºÛŒØ± `base_url` Ø±Ø§ Ø¨Ù‡ Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± Ø®ÙˆØ¯ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: `http://localhost:8000`)
3. Ø§Ø¨ØªØ¯Ø§ endpoint "Login" Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯ ØªØ§ token Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯ (Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± collection variable Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
4. Ø³Ø§ÛŒØ± endpointâ€ŒÙ‡Ø§ Ø±Ø§ ØªØ³Øª Ú©Ù†ÛŒØ¯

## Database Migrations

Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Alembic migrations Ø¯Ø± Docker:

```bash
# Ø³Ø§Ø®Øª migration Ø¬Ø¯ÛŒØ¯
docker exec -it bus_ticket_api alembic revision --autogenerate -m "description"

# Ø§Ø¹Ù…Ø§Ù„ migrations
docker exec -it bus_ticket_api alembic upgrade head

# rollback
docker exec -it bus_ticket_api alembic downgrade -1

# Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ
docker exec -it bus_ticket_api alembic current
```

**ğŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„:** ÙØ§ÛŒÙ„ `QUICK_START_DOCKER.md` Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ù†ÛŒØ¯.

## API Endpoints

### Authentication
- `POST /v1/auth/register` - Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
- `POST /v1/auth/login` - ÙˆØ±ÙˆØ¯ Ùˆ Ø¯Ø±ÛŒØ§ÙØª token

### Trips
- `GET /v1/trips/available` - Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø³ÙØ±Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
  - Query params: `origin`, `destination`, `sort` (cheapest/expensive)

### Booking
- `POST /v1/booking/reserve` - Ø±Ø²Ø±Ùˆ ØµÙ†Ø¯Ù„ÛŒ (Ù†ÛŒØ§Ø² Ø¨Ù‡ authentication)
- `GET /v1/booking/my-bookings` - Ù„ÛŒØ³Øª Ø¨Ù„ÛŒØ·â€ŒÙ‡Ø§ÛŒ Ù…Ù† (Ù†ÛŒØ§Ø² Ø¨Ù‡ authentication)
- `POST /v1/booking/cancel/{booking_id}` - Ù„ØºÙˆ Ø¨Ù„ÛŒØ· (Ù†ÛŒØ§Ø² Ø¨Ù‡ authentication)

### Admin
- `POST /v1/admin/bus` - Ø§ÛŒØ¬Ø§Ø¯ Ø§ØªÙˆØ¨ÙˆØ³ Ø¬Ø¯ÛŒØ¯ (Ù†ÛŒØ§Ø² Ø¨Ù‡ admin role)
- `GET /v1/admin/buses` - Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ø§ØªÙˆØ¨ÙˆØ³â€ŒÙ‡Ø§ (Ù†ÛŒØ§Ø² Ø¨Ù‡ admin role)
- `POST /v1/admin/trip` - Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ± Ø¬Ø¯ÛŒØ¯ (Ù†ÛŒØ§Ø² Ø¨Ù‡ admin role)
- `POST /v1/admin/wallet/charge` - Ø´Ø§Ø±Ú˜ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø± (Ù†ÛŒØ§Ø² Ø¨Ù‡ admin role)

### Reports (Admin Only)
- `GET /v1/admin/reports/hourly-success-bookings` - ØªØ¹Ø¯Ø§Ø¯ Ø±Ø²Ø±ÙˆÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚ Ø¯Ø± Ù‡Ø± Ø³Ø§Ø¹Øª
- `GET /v1/admin/reports/bus-monthly-income` - Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ø±Ø²Ø±Ùˆ Ù‡Ø± Ø§ØªÙˆØ¨ÙˆØ³ Ø¯Ø± Ù‡Ø± Ù…Ø§Ù‡
- `GET /v1/admin/reports/top-driver` - ÙØ¹Ø§Ù„â€ŒØªØ±ÛŒÙ† (Ù¾Ø±Ú©Ø§Ø±ØªØ±ÛŒÙ†) Ø§ØªÙˆØ¨ÙˆØ³

## ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ

- âœ… JWT Authentication
- âœ… Role-based Access Control (Admin, Operator, Passenger)
- âœ… Rate Limiting (20 Ø±Ø²Ø±Ùˆ Ø¯Ø± Ø±ÙˆØ² Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ø§Ø±Ø¨Ø±)
- âœ… Redis Distributed Lock Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² race condition
- âœ… Input Validation Ø¨Ø§ Pydantic
- âœ… SQL Injection Protection (Parameterized Queries)

## Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡

```
app/
â”œâ”€â”€ api/              # API endpoints (REST)
â”‚   â””â”€â”€ v1/
â”‚       â””â”€â”€ endpoints/
â”œâ”€â”€ core/             # Core configurations (config, security, dependencies)
â”œâ”€â”€ crud/             # Database operations
â”œâ”€â”€ db/               # Database session and base
â”œâ”€â”€ models/           # SQLAlchemy models
â”œâ”€â”€ schemas/          # Pydantic schemas (DTOs)
â”œâ”€â”€ services/         # Business logic layer
â””â”€â”€ utils/            # Utility functions
```

## ØªØ³Øªâ€ŒÙ‡Ø§

Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ù‡Ù…Ø²Ù…Ø§Ù†ÛŒ Ø³ÛŒØ³ØªÙ…:

```bash
python test/test_concurrent.py
```

## Ù†Ú©Ø§Øª Ù…Ù‡Ù…

- Ù‡Ø± Ø±Ø²Ø±Ùˆ Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ú©Ù…ØªØ± Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯ âœ…
- Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± Ø­Ø¯Ø§Ú©Ø«Ø± 20 Ø±Ø²Ø±Ùˆ Ø¯Ø± Ø±ÙˆØ² Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ âœ…
- Ù‡Ø± ØµÙ†Ø¯Ù„ÛŒ ÙÙ‚Ø· ÛŒÚ© Ø¨Ø§Ø± Ø¯Ø± Ù‡Ø± Ø³ÙØ± Ù‚Ø§Ø¨Ù„ Ø±Ø²Ø±Ùˆ Ø§Ø³Øª âœ…
- Ø³ÛŒØ³ØªÙ… Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 100,000 Ø±Ø²Ø±Ùˆ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ âœ…

